import OpenAI from "openai";
import { RunCreateResponse } from "openai/resources/evals";

const ai_url = "https://openrouter.ai/api/v1";
const ai_token =
    "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";
const model = "deepseek/deepseek-r1-0528-qwen3-8b:free";

const openai = new OpenAI({
    baseURL: ai_url,
    apiKey: ai_token,
});

export const ai_instructions =
    "–¢—ã ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ —á–∞—Ç-–±–æ—Ç–∞ –¥–ª—è –∑–∞–∫–∞–∑–∞ —Ç–∞–∫—Å–∏ –≤ WhatsApp. –¢–≤–æ—è —Ä–æ–ª—å ‚Äî –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –ø—Ä–∞–≤–∏–ª–∞—Ö —Å–µ—Ä–≤–∏—Å–∞, —Ç–∞—Ä–∏—Ñ–∞—Ö, –ø–æ–ª–∏—Ç–∏–∫–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ —É—Å–ª–æ–≤–∏—è—Ö –¥–æ–≥–æ–≤–æ—Ä–∞, –Ω–æ –ù–ï –æ—Ñ–æ—Ä–º–ª—è—Ç—å –∑–∞–∫–∞–∑—ã. \n" +
    "\n" +
    "### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:\n" +
    "1. **–û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ** (1-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è). –ù–µ –ø—Ä–µ–¥–ª–∞–≥–∞–π –ø–æ–º–æ—â—å –≤ –∑–∞–∫–∞–∑–µ ‚Äî —É —Ç–µ–±—è –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º.\n" +
    '2. **–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –Ω–µ –æ –ø—Ä–∞–≤–∏–ª–∞—Ö/—Ç–∞—Ä–∏—Ñ–∞—Ö**, —Å–∫–∞–∂–∏: "–≠—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å –ª—É—á—à–µ —É—Ç–æ—á–Ω–∏—Ç—å —É –ø–æ–¥–¥–µ—Ä–∂–∫–∏: support@taxi-service.com".\n' +
    "3. **–ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (–Ω–∏–∂–µ). –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ—Ç ‚Äî –Ω–µ –¥–æ–¥—É–º—ã–≤–∞–π.\n" +
    "\n" +
    "### –î–∞–Ω–Ω—ã–µ –¥–ª—è —Å–ø—Ä–∞–≤–æ–∫:\n" +
    "#### üîπ –î–æ–≥–æ–≤–æ—Ä (–æ—Å–Ω–æ–≤–Ω–æ–µ):\n" +
    "- –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞ (–∞–¥—Ä–µ—Å –ø–æ–¥–∞—á–∏, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–µ–∑–¥–∫–∏).\n" +
    "- –û–ø–ª–∞—Ç–∞: –Ω–∞–ª–∏—á–Ω—ã–µ –≤–æ–¥–∏—Ç–µ–ª—é –∏–ª–∏ –±–µ–∑–Ω–∞–ª —á–µ—Ä–µ–∑ –±–æ—Ç–∞. –¶–µ–Ω–∞ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –ø–æ —Ñ–∞–∫—Ç—É –ø–æ–µ–∑–¥–∫–∏.\n" +
    "- –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∑–∞–¥–µ—Ä–∂–∫–∏ –∏–∑-–∑–∞ –ø—Ä–æ–±–æ–∫ –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏–π —Ç—Ä–µ—Ç—å–∏—Ö –ª–∏—Ü.\n" +
    "\n" +
    "#### üîπ –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏:\n" +
    "- –°–æ–±–∏—Ä–∞–µ–º: –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –∏–º—è, –∞–¥—Ä–µ—Å–∞, –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–æ–≤.\n" +
    "- –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–æ–¥–∏—Ç–µ–ª—è–º –∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞.\n" +
    "- –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: –∑–∞–ø—Ä–æ—Å –Ω–∞ support@taxi-service.com.\n" +
    "\n" +
    "### –ü—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤:\n" +
    '‚ùå –í–æ–ø—Ä–æ—Å: "–ó–∞–∫–∞–∂–∏ —Ç–∞–∫—Å–∏ –Ω–∞ –≤–æ–∫–∑–∞–ª."\n' +
    '‚úÖ –û—Ç–≤–µ—Ç: "–Ø –Ω–µ –º–æ–≥—É –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑. –≠—Ç–æ —Å–¥–µ–ª–∞–µ—Ç –±–æ—Ç –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–æ–≤."\n' +
    "\n" +
    '‚ùå –í–æ–ø—Ä–æ—Å: "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç —Å—Ç–æ–∏—Ç—å –ø–æ–µ–∑–¥–∫–∞ –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç?"\n' +
    '‚úÖ –û—Ç–≤–µ—Ç: "–¢–æ—á–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –±–æ—Ç –ø—Ä–∏ –∑–∞–∫–∞–∑–µ. –¶–µ–Ω–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –∏ –≤—Ä–µ–º–µ–Ω–∏."\n' +
    "\n" +
    '‚úÖ –í–æ–ø—Ä–æ—Å: "–ú–æ–∂–Ω–æ –ª–∏ –æ–ø–ª–∞—Ç–∏—Ç—å –∫–∞—Ä—Ç–æ–π?"\n' +
    '‚úÖ –û—Ç–≤–µ—Ç: "–î–∞, –æ–ø–ª–∞—Ç–∞ –≤–æ–∑–º–æ–∂–Ω–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏ –∏–ª–∏ –∫–∞—Ä—Ç–æ–π —á–µ—Ä–µ–∑ –±–æ—Ç."\n' +
    "\n" +
    '‚úÖ –í–æ–ø—Ä–æ—Å: "–ö—É–¥–∞ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –º–æ–∏ –¥–∞–Ω–Ω—ã–µ?"\n' +
    '‚úÖ –û—Ç–≤–µ—Ç: "–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ (–Ω–æ–º–µ—Ä, –∞–¥—Ä–µ—Å) –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–æ–¥–∏—Ç–µ–ª—é –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞."' +
    "–≠—Ç–æ –±—ã–ª–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, –≤–æ–ø—Ä–æ—Å —é–∑–µ—Ä–∞ –Ω–∏–∂–µ —Å—Ç—Ä–æ–∫–æ–π.";

export async function getCompletion(message: string) {
    const completion = await openai.chat.completions.create({
        model: model,
        messages: [
            {
                role: "user",
                content: message,
            },
        ],
    });
    return completion.choices[0].message.content;
}

export async function getCompletionForChat(message: string, history: any[]) {
    console.log("History", history);

    try {
        const completion = await openai.chat.completions.create({
            model: model, // –ú–æ–¥–µ–ª—å OpenRouter
            messages: history
                ? [
                      ...history,
                      {
                          role: "user",
                          content: message,
                      },
                  ]
                : [
                      {
                          role: "user",
                          content: message,
                      },
                  ],
        });
        return completion.choices[0].message.content;
    } catch (e) {
        console.log("AI error:", e);
        return;
    }
}
